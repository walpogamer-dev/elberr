<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Albert - Asistente Personal</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />

<style>
:root {
    --primary: #00eaff;
    --primary-glow: rgba(0, 234, 255, 0.3);
    --dark-bg: #0b0f1a;
    --card-bg: #111827;
    --text-light: #f1f5f9;
    --text-muted: #94a3b8;
    --border: rgba(0, 234, 255, 0.15);
}
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, var(--dark-bg), #0f172a);
    color: var(--text-light);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
}

.container {
    width: 100%;
    max-width: 1000px;
    height: 90vh;
    background: var(--card-bg);
    border-radius: 20px;
    box-shadow: 0 0 60px var(--primary-glow);
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.header { padding: 20px; text-align: center; background: linear-gradient(90deg, #0f172a, #1e293b); }
.header h1 { font-family: 'Orbitron', sans-serif; font-size: 2rem; color: var(--primary); text-shadow: 0 0 10px var(--primary-glow); }

/* ===== CARA ===== */
.face-container { display: flex; justify-content: center; padding: 20px; }
.face {
    width: 200px; height: 200px; background: black;
    border-radius: 25px; display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    box-shadow: 0 0 40px var(--primary-glow); transition: 0.3s;
}
.eyes { display: flex; gap: 40px; }
.eye { width: 18px; height: 18px; background: var(--primary); border-radius: 50%; animation: blink 4s infinite; }
@keyframes blink { 0%,90%,100% {height:18px;} 95% {height:2px;} }
.mouth { width:70px; height:35px; border-bottom:4px solid var(--primary); border-radius:0 0 40px 40px; margin-top:25px; transition:0.3s; }
.face.thinking .mouth { width:40px; border-radius:0; }
.face.talking .mouth { height:20px; border-radius:50%; }
.face.error { box-shadow:0 0 40px red; }
.face.error .eye, .face.error .mouth { background:red; border-color:red; }

/* ===== CHAT ===== */
.chat-box { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:12px; }
.message { max-width:80%; padding:12px 18px; border-radius:18px; line-height:1.4; }
.user { align-self:flex-end; background:rgba(0,234,255,0.2); }
.albert { align-self:flex-start; background:rgba(255,255,255,0.08); }

.input-area { display:flex; padding:15px; gap:10px; border-top:1px solid var(--border); }
#user-input { flex:1; padding:12px 18px; border-radius:25px; border:1px solid var(--primary); background:#1e293b; color:white; }
button { padding:12px 20px; border-radius:25px; border:none; background:var(--primary); color:#0f172a; font-weight:bold; cursor:pointer; }
#status { text-align:center; padding:8px; color:var(--text-muted); font-size:0.9rem; }
</style>
</head>

<body>
<div class="container">
    <div class="header"><h1>Albert</h1></div>

    <div class="face-container">
        <div class="face" id="face">
            <div class="eyes">
                <div class="eye"></div>
                <div class="eye"></div>
            </div>
            <div class="mouth"></div>
        </div>
    </div>

    <div id="chat-box" class="chat-box"></div>
    <div id="status">Albert está escuchando...</div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Escribe tu mensaje" />
        <button onclick="sendMessage()">Enviar</button>
    </div>
</div>

<script>
const chatBox = document.getElementById('chat-box');
const userInput = document.getElementById('user-input');
const status = document.getElementById('status');
const face = document.getElementById('face');

function setFaceState(state) {
    face.classList.remove('thinking', 'talking', 'error');
    if (state) face.classList.add(state);
}

function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = 'message ' + role;
    div.innerHTML = '<strong>' + (role==='user'?'Tú: ':'Albert: ') + '</strong>' + text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
    const text = userInput.value.trim();
    if(!text) return;

    addMessage('user', text);
    userInput.value='';
    status.textContent='Albert está pensando...';
    setFaceState('thinking');

    try {
        // Aquí el fetch apunta al servidor Flask en la misma máquina
        const res = await fetch("http://127.0.0.1:5000/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text })
        });

        const data = await res.json();
        const reply = data.response;

        setFaceState('talking');
        addMessage('albert', reply);
        setTimeout(()=>setFaceState(null),1500);
        status.textContent="Albert está escuchando...";
    } catch(e) {
        setFaceState('error');
        addMessage('albert',"Error de conexión con el servidor.");
        status.textContent="Error";
    }
}

userInput.addEventListener('keypress', e=>{
    if(e.key==='Enter') sendMessage();
});
</script>
</body>
</html>